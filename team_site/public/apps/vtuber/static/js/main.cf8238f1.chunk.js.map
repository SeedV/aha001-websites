{"version":3,"sources":["components/global.js","components/Camera.js","hooks/useModel.js","models/BlazePoseLoader.js","components/BlazePose.js","utils/keypoints.js","components/Mousy.js","demos/CartoonMirror.js","components/KizunaAi.js","models/FaceMeshLoader.js","components/FaceMesh.js","demos/FaceMeshDemo.js","utils/gesture.js","models/HandPoseLoader.js","components/HandPose.js","demos/RockPaperScissors.js","utils/handpose.js","models/MoveNetLoader.js","components/VideoPlayback.js","demos/VideoPlaybackDemo.js","App.js","index.js"],"names":["VideoContext","createContext","initVideoState","video","Camera","props","webcamRef","useRef","canvasRef","useState","videoState","setVideoState","requestRef","onAnimate","useCallback","current","readyState","videoWidth","videoHeight","width","height","prevState","requestAnimationFrame","useEffect","cancelAnimationFrame","ref","mirrored","style","Provider","value","children","tfjsWasm","useModel","loader","backend","modelRef","load","a","tf","then","getAsync","console","warn","setBackend","BlazePoseLoader","type","runtime","posedetection","BlazePose","modelType","solutionPath","Error","useContext","detector","maxPoses","flipHorizontal","onPoseEstimate","onEstimate","poseDetector","estimatePoses","forEach","pose","getYRotation","p1","p2","pivot","e1","Math","abs","x","normalize","PI","getZRotation","y","min","max","val","quaternionFrom","first","middle","last","v1","Vector3","subVectors","v2","quaternion","Quaternion","setFromUnitVectors","Mousy","kp","group","mesh","useGLTF","nodes","materials","useFrame","state","delta","keypoints","Ch14","skeleton","bones","setRotationFromEuler","score","Euler","z","getHeadRotation","lShoulder","rShoulder","lElbow","rElbow","lWrist","rWrist","setRotationFromQuaternion","dispose","name","rotation","scale","object","mixamorigHips","geometry","material","Ch14_Body","helper","physics","head","position","top","left","right","zIndex","CartoonMirror","lights","intensity","castShadow","colorManagement","shadowMap","camera","fov","fallback","FaceMeshLoader","faceLandmarksDetection","mediapipeFacemesh","FaceMesh","detectorRef","onFaceEstimate","estimateFaces","input","prediction","KizunaAi","mount","facemesh","frameId","clientWidth","clientHeight","kalmanFilter","KalmanFilter","observation","dynamic","previousHeadRotation","scene","THREE","renderer","antialias","alpha","gridHelper","undefined","ambient","directionalLight","clock","add","set","setClearColor","setSize","MMDAnimationHelper","MMDLoader","createIkHelper","createPhysicsHelper","bindBones","ikHelper","objects","get","ikSolver","createHelper","visible","animate","renderScene","window","norm","sqrt","clamp","num","scaledMesh","point","filter","previousCorrected","mean","morphTargetInfluences","p3","p4","p5","p6","p7","p8","opening","mar","mouthOpening","update","getDelta","render","appendChild","domElement","remove","FaceMeshDemo","url","callback","script","document","createElement","onload","setTimeout","src","getScript","Ammo","rock","fp","GestureDescription","addCurl","Finger","Thumb","FingerCurl","FullCurl","Index","Middle","Ring","Pinky","paper","NoCurl","addDirection","FingerDirection","VerticalUp","DiagonalUpLeft","DiagonalUpRight","scissor","HalfCurl","setWeight","HandPoseLoader","handpose","HandPose","onHandEstimate","hands","estimateHands","emojiMap","RockPaperScissors","estimator","GestureEstimator","gesture","setGesture","predictions","estimated","estimate","landmarks","gestures","length","best","reduce","b","confidence","scoreThreshold","drawPose","keypointIndices","adjacentPairs","ctx","drawKeypoint","drawKeypoints","fillStyle","strokeStyle","lineWidth","i","j","kp1","kp2","score1","score2","beginPath","moveTo","lineTo","stroke","drawSkeleton","keypoint","color","arc","fill","MoveNetLoader","MoveNet","SINGLEPOSE_LIGHTNING","VideoPlayback","videoRef","sourceRef","videoSource","setCanvas","autoPlay","onLoadedData","canvas","onEnded","VideoPlaybackDemo","selectedFile","setSelectedFile","model","getKeypointIndexBySide","getAdjacentPairs","setVideoSource","className","onChange","event","target","files","accept","onClick","URL","createObjectURL","getContext","clearRect","pathRockPaperScissors","pathCartoonMirror","pathFaceMesh","pathVideoPlayback","App","path","exact","to","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.cf8238f1.chunk.js","sourcesContent":["/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {createContext} from 'react';\n\nexport const VideoContext = createContext(null);\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useCallback, useEffect, useRef, useState} from 'react';\nimport Webcam from 'react-webcam';\nimport {VideoContext} from './global';\n\nconst initVideoState = {\n  video: null,\n};\n\nconst Camera = (props) => {\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [videoState, setVideoState] = useState(initVideoState);\n  const requestRef = useRef(null);\n\n  /**\n   * Handles animation frames.\n   */\n  const onAnimate = useCallback(() => {\n    if (\n      webcamRef.current != null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      const video = webcamRef.current.video;\n      const videoWidth = video.videoWidth;\n      const videoHeight = video.videoHeight;\n\n      webcamRef.current.video.width = videoWidth;\n      webcamRef.current.video.height = videoHeight;\n\n      canvasRef.current.width = videoWidth;\n      canvasRef.current.height = videoHeight;\n\n      setVideoState((prevState) => {\n        return {...prevState, video: video};\n      });\n    }\n    requestRef.current = requestAnimationFrame(onAnimate);\n  }, []);\n\n  useEffect(() => {\n    onAnimate();\n    return () => cancelAnimationFrame(requestRef.current);\n  }, [onAnimate]);\n\n  return (\n    <div>\n      <Webcam ref={webcamRef} mirrored style={props.style} />\n      <canvas ref={canvasRef} style={props.style} />\n      <VideoContext.Provider value={videoState}>\n        {props.children}\n      </VideoContext.Provider>\n    </div>\n  );\n};\n\nexport default Camera;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useEffect, useRef, useCallback} from 'react';\nimport * as tfjsWasm from '@tensorflow/tfjs-backend-wasm';\nimport * as tf from '@tensorflow/tfjs-core';\nimport '@tensorflow/tfjs-backend-webgl';\n\ntfjsWasm.setWasmPaths({\n  'tfjs-backend-wasm.wasm':\n      `https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@` +\n      `${tfjsWasm.version_wasm}/dist/tfjs-backend-wasm.wasm`,\n  'tfjs-backend-wasm-simd.wasm':\n      `https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@` +\n      `${tfjsWasm.version_wasm}/dist/tfjs-backend-wasm-simd.wasm`,\n  'tfjs-backend-wasm-threaded-simd.wasm':\n      `https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@` +\n      `${tfjsWasm.version_wasm}/dist/tfjs-backend-wasm-threaded-simd.wasm`,\n});\n\nconst useModel = (loader, props) => {\n  const {backend} = props;\n  const modelRef = useRef(null);\n  const load = useCallback(async () => {\n    modelRef.current = await loader(props);\n  }, [loader, props]);\n\n  /**\n   * Sets the backend.\n   * @param {string} backend\n   */\n  function setBackend(backend) {\n    tf.setBackend(backend).then(\n        () => {\n          if (!tf.env().getAsync('WASM_HAS_SIMD_SUPPORT') && backend ===\n              'wasm') {\n            console.warn('The backend is set to WebAssembly and SIMD support' +\n                'is turned off.\\nThis could bottleneck your performance ' +\n                'greatly, thus to prevent this enable SIMD Support in ' +\n                'chrome://flags');\n          }\n        });\n  }\n\n  useEffect(() => {\n    setBackend(backend);\n    load();\n  }, [backend, load]);\n\n  return modelRef;\n};\n\nexport default useModel;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as posedetection from '@tensorflow-models/pose-detection';\n\nconst BlazePoseLoader = (props) => {\n  const {type, runtime} = props;\n\n  if (runtime === 'mediapipe') {\n    return posedetection.createDetector(\n        posedetection.SupportedModels.BlazePose, {\n          runtime,\n          modelType: type != null ? type : 'full',\n          solutionPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/pose',\n        });\n  } else if (runtime === 'tfjs') {\n    return posedetection.createDetector(\n        posedetection.SupportedModels.BlazePose, {\n          runtime,\n          modelType: type != null ? type : 'full',\n        });\n  } else {\n    throw new Error('The runtime is not supported');\n  }\n};\n\nexport default BlazePoseLoader;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useContext, useEffect, useCallback} from 'react';\nimport {VideoContext} from './global';\nimport useModel from '../hooks/useModel';\nimport BlazePoseLoader from '../models/BlazePoseLoader';\n\nconst BlazePose = (props) => {\n  const videoState = useContext(VideoContext);\n  const loader = props.loader || BlazePoseLoader;\n  const detector = useModel(loader, props);\n  const {maxPoses = 1, flipHorizontal = false, onPoseEstimate} = props;\n\n  /**\n   * Processes the video image with the pose estimator.\n   *\n   * @param {HTMLMediaElement} video\n   */\n  const onEstimate = useCallback(async (video) => {\n    const poseDetector = detector.current;\n    if (poseDetector !== null) {\n      const poses = await poseDetector.estimatePoses(video, {\n        maxPoses: maxPoses,\n        flipHorizontal: flipHorizontal,\n      });\n      poses.forEach((pose) => {\n        onPoseEstimate(pose);\n      });\n    }\n  }, [detector, maxPoses, flipHorizontal, onPoseEstimate]);\n\n  useEffect(() => {\n    onEstimate(videoState.video);\n  }, [videoState, onEstimate]);\n\n  return null;\n};\n\nexport default BlazePose;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Vector3, Quaternion, Euler} from 'three';\n\nconst CONFIDENCE = 0.5;\n\n/**\n * Returns head rotation.\n *\n * @param {Array} kp\n * @return {Euler} head rotation.\n */\nfunction getHeadRotation(kp) {\n  if (kp[0].score < CONFIDENCE || kp[2].score < CONFIDENCE ||\n      kp[5].score < CONFIDENCE) {\n    return new Euler(0, 0, 0);\n  }\n  const y = getYRotation(kp[2], kp[5], kp[0]);\n  const z = getZRotation(kp[2], kp[5]);\n  return new Euler(0, y, z);\n}\n\n/**\n * Returns rotation angle on Y axis.\n *\n * The angle is measured in radians and normalized based on its raw coordinates.\n *\n * @param {Keypoint} p1\n * @param {Keypoint} p2\n * @param {Keypoint} pivot\n * @return {number} rotation on Y axis.\n */\nfunction getYRotation(p1, p2, pivot) {\n  const e1 = Math.abs(p1.x - pivot.x);\n  const e2 = Math.abs(p2.x - pivot.x);\n  return normalize(-100, 100, e2-e1) - Math.PI/2;\n}\n\n/**\n * Returns rotation angle on Z axis.\n *\n * The angle is measured in radians and normalized based on its raw coordinates.\n *\n * @param {Keypoint} p1\n * @param {Keypoint} p2\n * @return {number} rotation on Z axis.\n */\nfunction getZRotation(p1, p2) {\n  const e1 = Math.abs(p1.y);\n  const e2 = Math.abs(p2.y);\n  return normalize(-80, 80, e2-e1) - Math.PI/2;\n}\n\n/**\n * Returns a normalized value between 0 and 1.\n *\n * @param {number} min\n * @param {number} max\n * @param {number} val\n * @return {number}\n */\nfunction normalize(min, max, val) {\n  return ((val - min) / (max - min)) * Math.PI;\n}\n\n/**\n * Returns a quaternion to rotate between two 3D vectors. The first one is\n * pointing from first to middle. The second one is pointing from middle to\n * last.\n *\n * @param {Vector3} first\n * @param {Vector3} middle\n * @param {Vector3} last\n * @return {Quaternion} a quaternion to apply rotation.\n */\nfunction quaternionFrom(first, middle, last) {\n  const v1 = new Vector3();\n  v1.subVectors(first, middle).normalize();\n  const v2 = new Vector3();\n  v2.subVectors(middle, last).normalize();\n  const quaternion = new Quaternion();\n  quaternion.setFromUnitVectors(v1, v2);\n  return quaternion.normalize();\n}\n\nexport {getHeadRotation, quaternionFrom, getYRotation, getZRotation};\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useRef} from 'react';\nimport {useFrame} from '@react-three/fiber';\nimport {useGLTF} from '@react-three/drei';\n\nimport {quaternionFrom, getHeadRotation} from '../utils/keypoints';\nimport {Vector3} from 'three';\n\n/**\n * Renders a <Mousy/> component.\n *\n * @param {Props} props\n * @return {string} rendered JSX.\n */\nexport default function Mousy(props) {\n  let kp;\n  const group = useRef();\n  const mesh = useRef();\n  const {nodes, materials} = useGLTF('../../../mousy.glb');\n\n  useFrame((state, delta) => {\n    kp = props.keypoints.current;\n\n    if (kp != null) {\n      nodes.Ch14.skeleton.bones[5].setRotationFromEuler(\n          getHeadRotation(kp));\n\n      const lShoulder = new Vector3(kp[11].z, kp[11].x, kp[11].y);\n      const rShoulder = new Vector3(kp[12].z, kp[12].x, kp[12].y);\n      const lElbow = new Vector3(kp[13].z, kp[13].x, kp[13].y);\n      const rElbow = new Vector3(kp[14].z, kp[14].x, kp[14].y);\n      const lWrist = new Vector3(kp[15].z, kp[15].x, kp[15].y);\n      const rWrist = new Vector3(kp[16].z, kp[16].x, kp[16].y);\n      nodes.Ch14.skeleton.bones[8].setRotationFromQuaternion(\n          quaternionFrom(rShoulder, lShoulder, lElbow));\n      nodes.Ch14.skeleton.bones[9].setRotationFromQuaternion(\n          quaternionFrom(lShoulder, lElbow, lWrist));\n      nodes.Ch14.skeleton.bones[28].setRotationFromQuaternion(\n          quaternionFrom(rElbow, rShoulder, lShoulder));\n      nodes.Ch14.skeleton.bones[29].setRotationFromQuaternion(\n          quaternionFrom(rWrist, rElbow, rShoulder));\n    }\n  });\n\n  return (\n    <mesh\n      {...props}\n      ref={mesh}\n    >\n      <group ref={group} dispose={null}>\n        <group\n          name=\"Armature\"\n          rotation={[Math.PI / 2, 0, 0]}\n          scale={[0.01, 0.01, 0.01]}>\n          <primitive object={nodes.mixamorigHips} />\n          <skinnedMesh\n            geometry={nodes.Ch14.geometry}\n            material={materials.Ch14_Body}\n            skeleton={nodes.Ch14.skeleton} />\n        </group>\n      </group>\n    </mesh>\n  );\n}\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Camera from '../components/Camera';\nimport BlazePose from '../components/BlazePose';\nimport {Canvas} from '@react-three/fiber';\nimport Mousy from '../components/Mousy';\nimport {Suspense, useRef} from 'react';\n\nconst style = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  zIndex: -1,\n  width: 160,\n  height: 120,\n};\n\nconst CartoonMirror = (props) => {\n  const keypoints = useRef();\n\n  const onPoseEstimate = (pose) => {\n    keypoints.current = pose.keypoints;\n  };\n\n  const lights = <>\n    <ambientLight intensity={0.4} />\n    <directionalLight\n      castShadow\n      position={[-8, 16, -8]}\n      intensity={0}\n      shadow-mapSize-width={1024}\n      shadow-mapSize-height={1024}\n      shadow-camera-far={50}\n      shadow-camera-left={-10}\n      shadow-camera-right={10}\n      shadow-camera-top={10}\n      shadow-camera-bottom={-10} />\n    <pointLight position={[0, 50, 0]} intensity={2} />\n  </>;\n\n  return <div>\n    <Camera style={style}>\n      <BlazePose\n        backend='wasm'\n        runtime='mediapipe'\n        maxPoses={1}\n        flipHorizontal={true}\n        onPoseEstimate={onPoseEstimate}/>\n    </Camera>\n    <div style={{position: 'relative', width: 600, height: 600}}>\n      <Canvas\n        colorManagement\n        shadowMap\n        camera={{position: [0, 0, 2], fov: 60}}>\n        {lights}\n        <Suspense fallback={null}>\n          <Mousy keypoints={keypoints} position={[0, -1, 0]}/>\n        </Suspense>\n      </Canvas>\n    </div>\n  </div>;\n};\n\nexport default CartoonMirror;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useEffect, useRef} from 'react';\nimport * as THREE from 'three';\nimport {MMDAnimationHelper} from\n  'three/examples/jsm/animation/MMDAnimationHelper.js';\nimport {MMDLoader} from 'three/examples/jsm/loaders/MMDLoader';\nimport {getYRotation, getZRotation} from '../utils/keypoints';\nimport {Euler} from 'three';\nimport {KalmanFilter} from 'kalman-filter';\n\n/** @type {MMDAnimationHelper} */\nlet helper;\nconst modelFile = '../../../kizunaai/kizunaai.pmx';\n/** @type {MMDAnimationHelperMixer.physics} */\nlet physics;\nlet head;\n\n/**\n  * Renders a <KizunaAi/> Actor.\n  *\n  * @param {Props} props\n  * @return {string} rendered JSX.\n  */\nexport default function KizunaAi(props) {\n  const mount = useRef(null);\n\n  useEffect(() => {\n    let facemesh;\n    const width = mount.current.clientWidth;\n    const height = mount.current.clientHeight;\n    /** @type {number} */\n    let frameId;\n    const kalmanFilter = new KalmanFilter({\n      observation: 2,\n      dynamic: 'constant-position',\n    });\n    let previousHeadRotation = null;\n\n    const scene = new THREE.Scene();\n    const camera = new THREE.PerspectiveCamera(20, width / height, 0.1, 1000);\n    const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});\n    const gridHelper = new THREE.PolarGridHelper(\n        30,\n        10,\n        8,\n        64,\n        undefined,\n        undefined,\n    );\n    const ambient = new THREE.AmbientLight(0x666666);\n    const directionalLight = new THREE.DirectionalLight(0x887766);\n    const clock = new THREE.Clock();\n\n    let mesh;\n    scene.add(ambient);\n    directionalLight.position.set(-1, 1, 1).normalize();\n    scene.add(directionalLight);\n\n    gridHelper.position.y = -18;\n    scene.add(gridHelper);\n\n    camera.position.set(0, 0, 16);\n    renderer.setClearColor(0x000000, 0);\n    renderer.setSize(width, height);\n\n    helper = new MMDAnimationHelper();\n    /** @type {MMDLoader} */\n    const mmdLoader = new MMDLoader();\n    mmdLoader.load(modelFile, async (object) => {\n      mesh = object;\n      mesh.position.y = gridHelper.position.y;\n\n      scene.add(mesh);\n\n      helper.add(mesh, {physics: true});\n\n      createIkHelper();\n      createPhysicsHelper();\n      bindBones();\n    });\n\n    const createIkHelper = () => {\n      const ikHelper = helper.objects.get(mesh)?.ikSolver.createHelper();\n\n      if (ikHelper) {\n        ikHelper.visible = false;\n        scene.add(ikHelper);\n      }\n    };\n\n    const createPhysicsHelper = () => {\n      physics = helper.objects.get(mesh)?.physics;\n    };\n\n    const bindBones = () => {\n      const bones = physics?.mesh.skeleton.bones;\n      if (bones) {\n        head = bones[8];\n      }\n    };\n\n    const start = () => {\n      if (!frameId) {\n        frameId = requestAnimationFrame(animate);\n      }\n    };\n\n    const stop = () => {\n      cancelAnimationFrame(frameId);\n      frameId = null;\n    };\n\n    const animate = () => {\n      renderScene();\n      frameId = window.requestAnimationFrame(animate);\n    };\n\n    const norm = (p1, p2) => {\n      return ((x, y) => Math.sqrt(x * x + y * y))(p1[0] - p2[0], p1[1] - p2[1]);\n    };\n\n    const mouthOpening = (mar) => {\n      if (mar < 0.2) {\n        return 0;\n      } else if (mar < 0.3) {\n        return 11;\n      } else if (mar < 0.4) {\n        return 12;\n      } else if (mar < 0.6) {\n        return 13;\n      } else {\n        return 14;\n      }\n    };\n\n    const clamp = (num, min, max) => {\n      return Math.min(Math.max(num, min), max);\n    };\n\n    const renderScene = () => {\n      facemesh = props.facemesh.current;\n      if (facemesh != null) {\n        if (head != null) {\n          const mesh = facemesh.scaledMesh;\n          const y = clamp(\n              getYRotation(point(mesh[33]), point(mesh[263]), point(mesh[1])),\n              -0.4, 0.4);\n          const z = clamp(\n              getZRotation(point(mesh[33]), point(mesh[263])),\n              -0.4, 0.4);\n          previousHeadRotation = kalmanFilter.filter(\n              {previousCorrected: previousHeadRotation, observation: [y, z]});\n          head.setRotationFromEuler(\n              new Euler(0,\n                  previousHeadRotation.mean[0],\n                  previousHeadRotation.mean[1]));\n        }\n        if (mesh.morphTargetInfluences) {\n          mesh.morphTargetInfluences[11] = 0;\n          mesh.morphTargetInfluences[12] = 0;\n          mesh.morphTargetInfluences[13] = 0;\n          mesh.morphTargetInfluences[14] = 0;\n          const scaledMesh = facemesh.scaledMesh;\n          const p1 = scaledMesh[78];\n          const p2 = scaledMesh[81];\n          const p3 = scaledMesh[13];\n          const p4 = scaledMesh[311];\n          const p5 = scaledMesh[308];\n          const p6 = scaledMesh[402];\n          const p7 = scaledMesh[14];\n          const p8 = scaledMesh[178];\n\n          const mar = (norm(p2, p8) + norm(p3, p7) + norm(p4, p6)) /\n            (2 * norm(p1, p5) + 1e-6);\n\n          const opening = mouthOpening(mar);\n          if (opening > 0) {\n            mesh.morphTargetInfluences[opening] = 1;\n          }\n        }\n      }\n      helper.update(clock.getDelta());\n      renderer.render(scene, camera);\n    };\n\n    const point = (mesh) => {\n      return {x: mesh[0], y: mesh[1]};\n    };\n\n    mount.current.appendChild(renderer.domElement);\n    start();\n    return () => {\n      stop();\n      scene.remove(ambient);\n      scene.remove(gridHelper);\n      scene.remove(mesh);\n      ambient.dispose();\n    };\n  }, []); // eslint-disable-line\n\n  return (\n    <div ref={mount} style={{position: 'relative', width: 600, height: 600}} />\n  );\n}\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as faceLandmarksDetection\n  from '@tensorflow-models/face-landmarks-detection';\n\nconst FaceMeshLoader = (props) => {\n  return faceLandmarksDetection.load(\n      faceLandmarksDetection.SupportedPackages.mediapipeFacemesh);\n};\n\nexport default FaceMeshLoader;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useContext, useEffect, useCallback} from 'react';\nimport {VideoContext} from './global';\nimport useModel from '../hooks/useModel';\nimport FaceMeshLoader from '../models/FaceMeshLoader';\n\nconst FaceMesh = (props) => {\n  const videoState = useContext(VideoContext);\n  const detectorRef = useModel(FaceMeshLoader, props);\n  const {onFaceEstimate} = props;\n\n  /**\n    * Processes the video image with the pose estimator.\n    *\n    * @param {HTMLMediaElement} video\n    */\n  const onEstimate = useCallback(async (video) => {\n    const detector = detectorRef.current;\n    if (detector !== null) {\n      const predictions = await detector.estimateFaces({\n        input: video,\n      });\n      predictions.forEach((prediction) => {\n        onFaceEstimate(prediction);\n      });\n    }\n  }, [detectorRef, onFaceEstimate]);\n\n  useEffect(() => {\n    onEstimate(videoState.video);\n  }, [videoState, onEstimate]);\n\n  return null;\n};\n\nexport default FaceMesh;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Camera from '../components/Camera';\nimport FaceMesh from '../components/FaceMesh';\nimport KizunaAi from '../components/KizunaAi';\nimport {useEffect, useRef} from 'react';\n\nconst style = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  zIndex: -1,\n  width: 160,\n  height: 120,\n};\n\nconst ammoJs = 'https://cdn.jsdelivr.net/gh/mrdoob/three.js/examples/js/libs/ammo.wasm.js';\n\nconst FaceMeshDemo = (props) => {\n  const facemesh = useRef();\n  /**\n   * Handles face estimation.\n   * @param {Object} prediction\n   */\n  function onFaceEstimate(prediction) {\n    facemesh.current = prediction;\n  }\n\n  /**\n   * Fetch the script and call the callback function.\n   * @param {string} url\n   * @param {Function} callback\n   */\n  function getScript(url, callback) {\n    const script = document.createElement('script');\n    script.onload = () => {\n      setTimeout(callback);\n    };\n    script.src = url;\n    document.head.appendChild(script);\n  }\n\n  useEffect(() => {\n    getScript(ammoJs, () => {\n      if (window.Ammo) {\n        // eslint-disable-next-line\n        window.Ammo().then(async () => {\n\n        });\n      }\n    });\n  }, []);\n\n  return <div>\n    <Camera style={style}>\n      <FaceMesh\n        backend='webgl'\n        onFaceEstimate={onFaceEstimate} />\n    </Camera>\n    <KizunaAi facemesh={facemesh} position={[0, -1, 0]}/>\n  </div>;\n};\n\nexport default FaceMeshDemo;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fp from 'fingerpose';\n\nconst rock = new fp.GestureDescription('rock');\n\nrock.addCurl(fp.Finger.Thumb, fp.FingerCurl.FullCurl, 1.0);\nrock.addCurl(fp.Finger.Index, fp.FingerCurl.FullCurl, 1.0);\nrock.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);\nrock.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);\nrock.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);\n\nconst paper = new fp.GestureDescription('paper');\n\npaper.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);\n\npaper.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);\npaper.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 1.0);\npaper.addDirection(fp.Finger.Index, fp.FingerDirection.DiagonalUpLeft, 0.75);\npaper.addDirection(fp.Finger.Index, fp.FingerDirection.DiagonalUpRight, 0.75);\n\npaper.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);\npaper.addDirection(fp.Finger.Middle, fp.FingerDirection.VerticalUp, 1.0);\npaper.addDirection(fp.Finger.Middle, fp.FingerDirection.DiagonalUpLeft, 0.75);\npaper.addDirection(fp.Finger.Middle, fp.FingerDirection.DiagonalUpRight, 0.75);\n\npaper.addCurl(fp.Finger.Ring, fp.FingerCurl.NoCurl, 1.0);\npaper.addDirection(fp.Finger.Ring, fp.FingerDirection.VerticalUp, 1.0);\npaper.addDirection(fp.Finger.Ring, fp.FingerDirection.DiagonalUpLeft, 0.75);\npaper.addDirection(fp.Finger.Ring, fp.FingerDirection.DiagonalUpRight, 0.75);\n\npaper.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);\npaper.addDirection(fp.Finger.Pinky, fp.FingerDirection.VerticalUp, 1.0);\npaper.addDirection(fp.Finger.Pinky, fp.FingerDirection.DiagonalUpLeft, 0.75);\npaper.addDirection(fp.Finger.Pinky, fp.FingerDirection.DiagonalUpRight, 0.75);\n\nconst scissor = new fp.GestureDescription('scissor');\n\nscissor.addCurl(fp.Finger.Thumb, fp.FingerCurl.HalfCurl, 0.5);\nscissor.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 0.5);\nscissor.addDirection(fp.Finger.Thumb, fp.FingerDirection.VerticalUp, 1.0);\nscissor.addDirection(fp.Finger.Thumb, fp.FingerDirection.DiagonalUpLeft, 1.0);\n\nscissor.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);\nscissor.addDirection(fp.Finger.Index, fp.FingerDirection.VerticalUp, 0.75);\nscissor.addDirection(fp.Finger.Index, fp.FingerDirection.DiagonalUpLeft, 1.0);\n\nscissor.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);\nscissor.addDirection(fp.Finger.Middle, fp.FingerDirection.VerticalUp, 0.75);\nscissor.addDirection(fp.Finger.Middle, fp.FingerDirection.DiagonalUpRight, 1.0);\n\nscissor.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);\nscissor.addCurl(fp.Finger.Ring, fp.FingerCurl.HalfCurl, 0.5);\n\nscissor.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);\nscissor.addCurl(fp.Finger.Pinky, fp.FingerCurl.HalfCurl, 0.5);\n\nscissor.setWeight(fp.Finger.Index, 2);\nscissor.setWeight(fp.Finger.Middle, 2);\n\nexport {rock, paper, scissor};\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as handpose from '@tensorflow-models/handpose';\n\nconst HandPoseLoader = () => {\n  return handpose.load();\n};\n\nexport default HandPoseLoader;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useContext, useEffect, useCallback} from 'react';\nimport {VideoContext} from './global';\nimport useModel from '../hooks/useModel';\nimport HandPoseLoader from '../models/HandPoseLoader';\n\nconst HandPose = (props) => {\n  const videoState = useContext(VideoContext);\n  const detector = useModel(HandPoseLoader, props);\n  const {onHandEstimate} = props;\n\n  /**\n   * Processes the video image with the pose estimator.\n   *\n   * @param {HTMLMediaElement} video\n   */\n  const onEstimate = useCallback(async (video) => {\n    const hands = detector.current;\n    if (hands !== null) {\n      const predictions = await hands.estimateHands(video);\n      predictions.forEach((prediction) => {\n        onHandEstimate(prediction);\n      });\n    }\n  }, [detector, onHandEstimate]);\n\n  useEffect(() => {\n    onEstimate(videoState.video);\n  }, [videoState, onEstimate]);\n\n  return null;\n};\n\nexport default HandPose;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Camera from '../components/Camera';\nimport fp from 'fingerpose';\nimport {useRef, useState} from 'react';\nimport {rock, paper, scissor} from '../utils/gesture';\nimport HandPose from '../components/HandPose';\n\nconst style = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  right: 0,\n  zIndex: -1,\n  width: 640,\n  height: 480,\n};\n\nconst emojiMap = {\n  'scissor': '✌🏻',\n  'rock': '✊',\n  'paper': '✋',\n};\n\nconst RockPaperScissors = (props) => {\n  const estimator = useRef(new fp.GestureEstimator([rock, paper, scissor]));\n  const [gesture, setGesture] = useState();\n\n  /**\n   * Handles hand estimate.\n   * @param {Object} predictions\n   */\n  function onHandEstimate(predictions) {\n    const estimated = estimator.current.estimate(predictions.landmarks, 7.5);\n    if (estimated.gestures.length > 0) {\n      const best = estimated.gestures.reduce((a, b) => {\n        return (a.confidence > b.confidence) ? a : b;\n      });\n      if (gesture !== best.name) {\n        setGesture(best.name);\n      }\n    }\n  }\n\n  return (\n    <>\n      <div style={{position: 'fixed', left: 32}}>\n        <h1>{emojiMap[gesture]}</h1>\n      </div>\n      <Camera style={style}>\n        <HandPose backend='webgl' onHandEstimate={onHandEstimate}/>\n      </Camera>\n    </>\n  );\n};\n\nexport default RockPaperScissors;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst fingerJoints = {\n  thumb: [0, 1, 2, 3, 4],\n  indexFinger: [0, 5, 6, 7, 8],\n  middleFinger: [0, 9, 10, 11, 12],\n  ringFinger: [0, 13, 14, 15, 16],\n  pinky: [0, 17, 18, 19, 20],\n};\n\nconst scoreThreshold = 0.65;\n\n/**\n * Draws a hand.\n * @param {Array<number>} landmarks\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawHand(landmarks, ctx) {\n  for (let j = 0; j < Object.keys(fingerJoints).length; j++) {\n    const finger = Object.keys(fingerJoints)[j];\n    //  Loop through pairs of joints\n    for (let k = 0; k < fingerJoints[finger].length - 1; k++) {\n      // Get pairs of joints\n      const firstJointIndex = fingerJoints[finger][k];\n      const secondJointIndex = fingerJoints[finger][k + 1];\n      drawPath(landmarks[firstJointIndex], landmarks[secondJointIndex], ctx);\n    }\n  }\n\n  landmarks.forEach((landmark) => {\n    drawPoint(landmark[0], landmark[1], ctx);\n  });\n}\n\n/**\n * Draws a point.\n * @param {number} x\n * @param {number} y\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawPoint(x, y, ctx) {\n  ctx.beginPath();\n  ctx.arc(x, y, 3, 0, 2 * Math.PI);\n  ctx.fillStyle = 'red';\n  ctx.fill();\n}\n\n/**\n * Draws a path.\n * @param {number} from\n * @param {number} to\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawPath(from, to, ctx) {\n  ctx.beginPath();\n  ctx.moveTo(from[0], from[1]);\n  ctx.lineTo(to[0], to[1]);\n  ctx.strokeStyle = 'lime';\n  ctx.lineWidth = 4;\n  ctx.stroke();\n}\n\n/**\n * Draws a pose.\n * @param {Object} predictions\n * @param {Array<Object>} keypointIndices\n * @param {Array<Object>} adjacentPairs\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawPose(predictions, keypointIndices, adjacentPairs, ctx) {\n  const keypoints = predictions.keypoints;\n  drawKeypoints(keypoints, keypointIndices, ctx);\n  drawSkeleton(keypoints, adjacentPairs, ctx);\n}\n\n/**\n * Draws all keypoints. The keypoints to the left are in lime, the keypoints to\n * the right are in red, the keypoints to the middle are in yellow.\n * @param {Array<Object>} keypoints\n * @param {Array<Object>} keypointIndices\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawKeypoints(keypoints, keypointIndices, ctx) {\n  for (const i of keypointIndices.middle) {\n    drawKeypoint(keypoints[i], 'yellow', ctx);\n  }\n\n  for (const i of keypointIndices.left) {\n    drawKeypoint(keypoints[i], 'lime', ctx);\n  }\n\n  for (const i of keypointIndices.right) {\n    drawKeypoint(keypoints[i], 'red', ctx);\n  }\n}\n\n/**\n * Draws a keypoint.\n * @param {Object} keypoint\n * @param {string} color\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawKeypoint(keypoint, color, ctx) {\n  const score = keypoint.score != null ? keypoint.score : 1;\n  if (score >= scoreThreshold) {\n    ctx.beginPath();\n    ctx.arc(keypoint.x, keypoint.y, 5, 0, 2 * Math.PI);\n    ctx.fillStyle = color;\n    ctx.fill();\n  }\n}\n\n/**\n * Draws a skeleton.\n * @param {Array<Object>} keypoints\n * @param {Array<Object>} adjacentPairs\n * @param {CanvasRenderingContext2D} ctx\n */\nfunction drawSkeleton(keypoints, adjacentPairs, ctx) {\n  ctx.fillStyle = 'White';\n  ctx.strokeStyle = 'White';\n  ctx.lineWidth = 3;\n\n  adjacentPairs\n      .forEach(([i, j]) => {\n        const kp1 = keypoints[i];\n        const kp2 = keypoints[j];\n\n        // If score is null, just show the keypoint.\n        const score1 = kp1.score != null ? kp1.score : 1;\n        const score2 = kp2.score != null ? kp2.score : 1;\n\n        if (score1 >= scoreThreshold && score2 >= scoreThreshold) {\n          ctx.beginPath();\n          ctx.moveTo(kp1.x, kp1.y);\n          ctx.lineTo(kp2.x, kp2.y);\n          ctx.stroke();\n        }\n      });\n}\n\nexport {drawHand, drawPose};\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as posedetection from '@tensorflow-models/pose-detection';\n\nconst MoveNetLoader = (props) => {\n  const {type, runtime} = props;\n\n  return posedetection.createDetector(\n      posedetection.SupportedModels.MoveNet, {\n        runtime,\n        modelType: type || posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING,\n      });\n};\n\nexport default MoveNetLoader;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {useEffect, useRef, useState} from 'react';\nimport {VideoContext} from './global';\n\nconst initVideoState = {\n  video: null,\n};\n\nconst VideoPlayback = (props) => {\n  const videoRef = useRef(null);\n  const sourceRef = useRef(null);\n  const canvasRef = useRef(null);\n  const requestRef = useRef(null);\n  const [videoState, setVideoState] = useState(initVideoState);\n  const {style, videoSource, setCanvas} = props;\n\n  const run = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    setCanvas(canvas);\n    animate();\n  };\n\n  const animate = () => {\n    setVideoState((prevState) => {\n      return {...prevState, video: videoRef.current};\n    });\n    requestRef.current = requestAnimationFrame(animate);\n  };\n\n  const onEnded = () => {\n    // TODO: dispose the detector.\n  };\n\n  useEffect(() => {\n    sourceRef.current.src = videoSource;\n    videoRef.current.load();\n  }, [videoSource]);\n\n  return (\n    <div>\n      <video ref={videoRef} autoPlay onLoadedData={run} onEnded={onEnded}\n        style={style}>\n        <source ref={sourceRef} type=\"video/mp4\"/>\n      </video>\n      <canvas ref={canvasRef} style={style}/>\n      <VideoContext.Provider value={videoState}>\n        {props.children}\n      </VideoContext.Provider>\n    </div>\n  );\n};\n\nexport default VideoPlayback;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './VideoPlaybackDemo.css';\nimport {useRef, useState} from 'react';\nimport * as posedetection from '@tensorflow-models/pose-detection';\nimport {drawPose} from '../utils/handpose';\nimport MoveNetLoader from '../models/MoveNetLoader';\nimport VideoPlayback from '../components/VideoPlayback';\nimport BlazePose from '../components/BlazePose';\n\nconst VideoPlaybackDemo = (props) => {\n  const [selectedFile, setSelectedFile] = useState(null);\n  const canvasRef = useRef(null);\n  const model = posedetection.SupportedModels.MoveNet;\n  const keypointIndices = posedetection.util.getKeypointIndexBySide(model);\n  const adjacentPairs = posedetection.util.getAdjacentPairs(model);\n\n  const style = {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    zIndex: 9,\n  };\n\n  const [videoSource, setVideoSource] = useState(null);\n\n  const fileSelectedHandler = (event) => {\n    setSelectedFile(event.target.files[0]);\n  };\n\n  const fileUploadHandler = () => {\n    setVideoSource(URL.createObjectURL(selectedFile));\n  };\n\n  const onPoseEstimate = (pose) => {\n    const ctx = canvasRef.current.getContext('2d');\n    const canvas = canvasRef.current;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    drawPose(pose, keypointIndices, adjacentPairs, ctx);\n  };\n\n  const setCanvas = (canvas) => {\n    canvasRef.current = canvas;\n  };\n\n  return (\n    <div className=\"App\">\n      {videoSource == null && <>\n        <input type=\"file\" onChange={fileSelectedHandler} accept=\"video/*\"/>\n        <button onClick={fileUploadHandler}>Upload</button>\n      </>}\n      <VideoPlayback style={style} videoSource={videoSource}\n        setCanvas={setCanvas}>\n        <BlazePose\n          backend='webgl'\n          runtime='tfjs'\n          type={posedetection.movenet.modelType.SINGLEPOSE_LIGHTNING}\n          maxPoses={1}\n          flipHorizontal={true}\n          loader={MoveNetLoader}\n          onPoseEstimate={onPoseEstimate}/>\n      </VideoPlayback>\n    </div>\n  );\n};\n\nexport default VideoPlaybackDemo;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from 'react-router-dom';\nimport CartoonMirror from './demos/CartoonMirror';\nimport FaceMeshDemo from './demos/FaceMeshDemo';\nimport RockPaperScissors from './demos/RockPaperScissors';\nimport VideoPlaybackDemo from './demos/VideoPlaybackDemo';\n\nconst pathRockPaperScissors = '/rockpaperscissors';\nconst pathCartoonMirror = '/cartoonmirror';\nconst pathFaceMesh = '/facemesh';\nconst pathVideoPlayback = '/videoplayback';\n\n/**\n * The app component.\n * @return {JSX.Element}\n */\nfunction App() {\n  return (\n    <Router>\n      <div>\n        <Switch>\n          <Route path=\"/\" exact>\n          This page shows a list of demos in this project.\n            <ul>\n              <li>\n                <Link to={pathRockPaperScissors}>RockPaperScissors</Link>\n              </li>\n              <li>\n                <Link to={pathCartoonMirror}>CartoonMirror</Link>\n              </li>\n              <li>\n                <Link to={pathFaceMesh}>FaceMesh</Link>\n              </li>\n              <li>\n                <Link to={pathVideoPlayback}>VideoPlayback</Link>\n              </li>\n            </ul>\n          </Route>\n          <Route path={pathRockPaperScissors}>\n            <RockPaperScissors />\n          </Route>\n          <Route path={pathCartoonMirror}>\n            <CartoonMirror />\n          </Route>\n          <Route path={pathFaceMesh}>\n            <FaceMeshDemo />\n          </Route>\n          <Route path={pathVideoPlayback}>\n            <VideoPlaybackDemo />\n          </Route>\n        </Switch>\n      </div>\n    </Router>\n  );\n}\n\nexport default App;\n","/**\n * @license\n * Copyright 2021 The Aha001 Team.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById('root'));\n"],"sourceRoot":""}