/*! For license information please see main.cf8238f1.chunk.js.LICENSE.txt */
(this["webpackJsonpreact-blazepalm"]=this["webpackJsonpreact-blazepalm"]||[]).push([[0],{124:function(e,n){},180:function(e,n){},313:function(e,n,t){},320:function(e,n){},321:function(e,n){},329:function(e,n){},330:function(e,n){},331:function(e,n){},332:function(e,n){},444:function(e,n,t){},450:function(e,n,t){"use strict";t.r(n);var r=t(16),i=t.n(r),a=t(264),c=t.n(a),o=(t(313),t(120)),s=t(46),l=t(25),u=t(7),d=t(265),f=t.n(d),j=Object(r.createContext)(null),b=t(21),h={video:null},p=function(e){var n=Object(r.useRef)(null),t=Object(r.useRef)(null),i=Object(r.useState)(h),a=Object(u.a)(i,2),c=a[0],o=a[1],s=Object(r.useRef)(null),d=Object(r.useCallback)((function(){if(null!=n.current&&4===n.current.video.readyState){var e=n.current.video,r=e.videoWidth,i=e.videoHeight;n.current.video.width=r,n.current.video.height=i,t.current.width=r,t.current.height=i,o((function(n){return Object(l.a)(Object(l.a)({},n),{},{video:e})}))}s.current=requestAnimationFrame(d)}),[]);return Object(r.useEffect)((function(){return d(),function(){return cancelAnimationFrame(s.current)}}),[d]),Object(b.jsxs)("div",{children:[Object(b.jsx)(f.a,{ref:n,mirrored:!0,style:e.style}),Object(b.jsx)("canvas",{ref:t,style:e.style}),Object(b.jsx)(j.Provider,{value:c,children:e.children})]})},m=t(10),g=t.n(m),v=t(17),O=t(135),x=t(0);t(449);O.a({"tfjs-backend-wasm.wasm":"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@"+"".concat(O.b,"/dist/tfjs-backend-wasm.wasm"),"tfjs-backend-wasm-simd.wasm":"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@"+"".concat(O.b,"/dist/tfjs-backend-wasm-simd.wasm"),"tfjs-backend-wasm-threaded-simd.wasm":"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@"+"".concat(O.b,"/dist/tfjs-backend-wasm-threaded-simd.wasm")});var F=function(e,n){var t=n.backend,i=Object(r.useRef)(null),a=Object(r.useCallback)(Object(v.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:i.current=t.sent;case 3:case"end":return t.stop()}}),t)}))),[e,n]);return Object(r.useEffect)((function(){!function(e){x.Nd(e).then((function(){x.yd().getAsync("WASM_HAS_SIMD_SUPPORT")||"wasm"!==e||console.warn("The backend is set to WebAssembly and SIMD supportis turned off.\nThis could bottleneck your performance greatly, thus to prevent this enable SIMD Support in chrome://flags")}))}(t),a()}),[t,a]),i},w=t(57),y=function(e){var n=e.type,t=e.runtime;if("mediapipe"===t)return w.b(w.a.BlazePose,{runtime:t,modelType:null!=n?n:"full",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/pose"});if("tfjs"===t)return w.b(w.a.BlazePose,{runtime:t,modelType:null!=n?n:"full"});throw new Error("The runtime is not supported")},C=function(e){var n=Object(r.useContext)(j),t=e.loader||y,i=F(t,e),a=e.maxPoses,c=void 0===a?1:a,o=e.flipHorizontal,s=void 0!==o&&o,l=e.onPoseEstimate,u=Object(r.useCallback)(function(){var e=Object(v.a)(g.a.mark((function e(n){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=i.current)){e.next=6;break}return e.next=4,t.estimatePoses(n,{maxPoses:c,flipHorizontal:s});case 4:e.sent.forEach((function(e){l(e)}));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[i,c,s,l]);return Object(r.useEffect)((function(){u(n.video)}),[n,u]),null},k=t(92),D=t(457),R=t(8);function P(e,n,t){var r=Math.abs(e.x-t.x);return M(-100,100,Math.abs(n.x-t.x)-r)-Math.PI/2}function I(e,n){var t=Math.abs(e.y);return M(-80,80,Math.abs(n.y)-t)-Math.PI/2}function M(e,n,t){return(t-e)/(n-e)*Math.PI}function E(e,n,t){var r=new R.Vector3;r.subVectors(e,n).normalize();var i=new R.Vector3;i.subVectors(n,t).normalize();var a=new R.Quaternion;return a.setFromUnitVectors(r,i),a.normalize()}function S(e){var n,t=Object(r.useRef)(),i=Object(r.useRef)(),a=Object(D.a)("../../../mousy.glb"),c=a.nodes,o=a.materials;return Object(k.b)((function(t,r){if(null!=(n=e.keypoints.current)){c.Ch14.skeleton.bones[5].setRotationFromEuler(function(e){if(e[0].score<.5||e[2].score<.5||e[5].score<.5)return new R.Euler(0,0,0);var n=P(e[2],e[5],e[0]),t=I(e[2],e[5]);return new R.Euler(0,n,t)}(n));var i=new R.Vector3(n[11].z,n[11].x,n[11].y),a=new R.Vector3(n[12].z,n[12].x,n[12].y),o=new R.Vector3(n[13].z,n[13].x,n[13].y),s=new R.Vector3(n[14].z,n[14].x,n[14].y),l=new R.Vector3(n[15].z,n[15].x,n[15].y),u=new R.Vector3(n[16].z,n[16].x,n[16].y);c.Ch14.skeleton.bones[8].setRotationFromQuaternion(E(a,i,o)),c.Ch14.skeleton.bones[9].setRotationFromQuaternion(E(i,o,l)),c.Ch14.skeleton.bones[28].setRotationFromQuaternion(E(s,a,i)),c.Ch14.skeleton.bones[29].setRotationFromQuaternion(E(u,s,a))}})),Object(b.jsx)("mesh",Object(l.a)(Object(l.a)({},e),{},{ref:i,children:Object(b.jsx)("group",{ref:t,dispose:null,children:Object(b.jsxs)("group",{name:"Armature",rotation:[Math.PI/2,0,0],scale:[.01,.01,.01],children:[Object(b.jsx)("primitive",{object:c.mixamorigHips}),Object(b.jsx)("skinnedMesh",{geometry:c.Ch14.geometry,material:o.Ch14_Body,skeleton:c.Ch14.skeleton})]})})}))}var z,T,U,H={position:"absolute",top:0,left:0,right:0,zIndex:-1,width:160,height:120},L=function(e){var n=Object(r.useRef)(),t=Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("ambientLight",{intensity:.4}),Object(b.jsx)("directionalLight",{castShadow:!0,position:[-8,16,-8],intensity:0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10}),Object(b.jsx)("pointLight",{position:[0,50,0],intensity:2})]});return Object(b.jsxs)("div",{children:[Object(b.jsx)(p,{style:H,children:Object(b.jsx)(C,{backend:"wasm",runtime:"mediapipe",maxPoses:1,flipHorizontal:!0,onPoseEstimate:function(e){n.current=e.keypoints}})}),Object(b.jsx)("div",{style:{position:"relative",width:600,height:600},children:Object(b.jsxs)(k.a,{colorManagement:!0,shadowMap:!0,camera:{position:[0,0,2],fov:60},children:[t,Object(b.jsx)(r.Suspense,{fallback:null,children:Object(b.jsx)(S,{keypoints:n,position:[0,-1,0]})})]})})]})},V=t(193),N=function(e){return V.b(V.a.mediapipeFacemesh)},A=function(e){var n=Object(r.useContext)(j),t=F(N,e),i=e.onFaceEstimate,a=Object(r.useCallback)(function(){var e=Object(v.a)(g.a.mark((function e(n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=t.current)){e.next=6;break}return e.next=4,r.estimateFaces({input:n});case 4:e.sent.forEach((function(e){i(e)}));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,i]);return Object(r.useEffect)((function(){a(n.video)}),[n,a]),null},G=t(295),W=t(294),_=t(290);function q(e){var n=Object(r.useRef)(null);return Object(r.useEffect)((function(){var t,r,i,a=n.current.clientWidth,c=n.current.clientHeight,o=new _.KalmanFilter({observation:2,dynamic:"constant-position"}),s=null,l=new R.Scene,u=new R.PerspectiveCamera(20,a/c,.1,1e3),d=new R.WebGLRenderer({antialias:!0,alpha:!0}),f=new R.PolarGridHelper(30,10,8,64,void 0,void 0),j=new R.AmbientLight(6710886),b=new R.DirectionalLight(8943462),h=new R.Clock;l.add(j),b.position.set(-1,1,1).normalize(),l.add(b),f.position.y=-18,l.add(f),u.position.set(0,0,16),d.setClearColor(0,0),d.setSize(a,c),z=new G.a,(new W.a).load("../../../kizunaai/kizunaai.pmx",function(){var e=Object(v.a)(g.a.mark((function e(n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=n).position.y=f.position.y,l.add(i),z.add(i,{physics:!0}),p(),m(),O();case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());var p=function(){var e,n=null===(e=z.objects.get(i))||void 0===e?void 0:e.ikSolver.createHelper();n&&(n.visible=!1,l.add(n))},m=function(){var e;T=null===(e=z.objects.get(i))||void 0===e?void 0:e.physics},O=function(){var e,n=null===(e=T)||void 0===e?void 0:e.mesh.skeleton.bones;n&&(U=n[8])},x=function e(){y(),r=window.requestAnimationFrame(e)},F=function(e,n){return t=e[0]-n[0],r=e[1]-n[1],Math.sqrt(t*t+r*r);var t,r},w=function(e,n,t){return Math.min(Math.max(e,n),t)},y=function(){if(null!=(t=e.facemesh.current)){if(null!=U){var n=t.scaledMesh,r=w(P(C(n[33]),C(n[263]),C(n[1])),-.4,.4),a=w(I(C(n[33]),C(n[263])),-.4,.4);s=o.filter({previousCorrected:s,observation:[r,a]}),U.setRotationFromEuler(new R.Euler(0,s.mean[0],s.mean[1]))}if(i.morphTargetInfluences){i.morphTargetInfluences[11]=0,i.morphTargetInfluences[12]=0,i.morphTargetInfluences[13]=0,i.morphTargetInfluences[14]=0;var c=t.scaledMesh,f=c[78],j=c[81],b=c[13],p=c[311],m=c[308],g=c[402],v=c[14],O=c[178],x=function(e){return e<.2?0:e<.3?11:e<.4?12:e<.6?13:14}((F(j,O)+F(b,v)+F(p,g))/(2*F(f,m)+1e-6));x>0&&(i.morphTargetInfluences[x]=1)}}z.update(h.getDelta()),d.render(l,u)},C=function(e){return{x:e[0],y:e[1]}};return n.current.appendChild(d.domElement),r||(r=requestAnimationFrame(x)),function(){cancelAnimationFrame(r),r=null,l.remove(j),l.remove(f),l.remove(i),j.dispose()}}),[]),Object(b.jsx)("div",{ref:n,style:{position:"relative",width:600,height:600}})}var B={position:"absolute",top:0,left:0,right:0,zIndex:-1,width:160,height:120},Q=function(e){var n=Object(r.useRef)();return Object(r.useEffect)((function(){!function(e,n){var t=document.createElement("script");t.onload=function(){setTimeout(n)},t.src=e,document.head.appendChild(t)}("https://cdn.jsdelivr.net/gh/mrdoob/three.js/examples/js/libs/ammo.wasm.js",(function(){window.Ammo&&window.Ammo().then(Object(v.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))))}))}),[]),Object(b.jsxs)("div",{children:[Object(b.jsx)(p,{style:B,children:Object(b.jsx)(A,{backend:"webgl",onFaceEstimate:function(e){n.current=e}})}),Object(b.jsx)(q,{facemesh:n,position:[0,-1,0]})]})},J=t(22),K=t.n(J),X=new K.a.GestureDescription("rock");X.addCurl(K.a.Finger.Thumb,K.a.FingerCurl.FullCurl,1),X.addCurl(K.a.Finger.Index,K.a.FingerCurl.FullCurl,1),X.addCurl(K.a.Finger.Middle,K.a.FingerCurl.FullCurl,1),X.addCurl(K.a.Finger.Ring,K.a.FingerCurl.FullCurl,1),X.addCurl(K.a.Finger.Pinky,K.a.FingerCurl.FullCurl,1);var Y=new K.a.GestureDescription("paper");Y.addCurl(K.a.Finger.Thumb,K.a.FingerCurl.NoCurl,1),Y.addCurl(K.a.Finger.Index,K.a.FingerCurl.NoCurl,1),Y.addDirection(K.a.Finger.Index,K.a.FingerDirection.VerticalUp,1),Y.addDirection(K.a.Finger.Index,K.a.FingerDirection.DiagonalUpLeft,.75),Y.addDirection(K.a.Finger.Index,K.a.FingerDirection.DiagonalUpRight,.75),Y.addCurl(K.a.Finger.Middle,K.a.FingerCurl.NoCurl,1),Y.addDirection(K.a.Finger.Middle,K.a.FingerDirection.VerticalUp,1),Y.addDirection(K.a.Finger.Middle,K.a.FingerDirection.DiagonalUpLeft,.75),Y.addDirection(K.a.Finger.Middle,K.a.FingerDirection.DiagonalUpRight,.75),Y.addCurl(K.a.Finger.Ring,K.a.FingerCurl.NoCurl,1),Y.addDirection(K.a.Finger.Ring,K.a.FingerDirection.VerticalUp,1),Y.addDirection(K.a.Finger.Ring,K.a.FingerDirection.DiagonalUpLeft,.75),Y.addDirection(K.a.Finger.Ring,K.a.FingerDirection.DiagonalUpRight,.75),Y.addCurl(K.a.Finger.Pinky,K.a.FingerCurl.NoCurl,1),Y.addDirection(K.a.Finger.Pinky,K.a.FingerDirection.VerticalUp,1),Y.addDirection(K.a.Finger.Pinky,K.a.FingerDirection.DiagonalUpLeft,.75),Y.addDirection(K.a.Finger.Pinky,K.a.FingerDirection.DiagonalUpRight,.75);var Z=new K.a.GestureDescription("scissor");Z.addCurl(K.a.Finger.Thumb,K.a.FingerCurl.HalfCurl,.5),Z.addCurl(K.a.Finger.Thumb,K.a.FingerCurl.NoCurl,.5),Z.addDirection(K.a.Finger.Thumb,K.a.FingerDirection.VerticalUp,1),Z.addDirection(K.a.Finger.Thumb,K.a.FingerDirection.DiagonalUpLeft,1),Z.addCurl(K.a.Finger.Index,K.a.FingerCurl.NoCurl,1),Z.addDirection(K.a.Finger.Index,K.a.FingerDirection.VerticalUp,.75),Z.addDirection(K.a.Finger.Index,K.a.FingerDirection.DiagonalUpLeft,1),Z.addCurl(K.a.Finger.Middle,K.a.FingerCurl.NoCurl,1),Z.addDirection(K.a.Finger.Middle,K.a.FingerDirection.VerticalUp,.75),Z.addDirection(K.a.Finger.Middle,K.a.FingerDirection.DiagonalUpRight,1),Z.addCurl(K.a.Finger.Ring,K.a.FingerCurl.FullCurl,1),Z.addCurl(K.a.Finger.Ring,K.a.FingerCurl.HalfCurl,.5),Z.addCurl(K.a.Finger.Pinky,K.a.FingerCurl.FullCurl,1),Z.addCurl(K.a.Finger.Pinky,K.a.FingerCurl.HalfCurl,.5),Z.setWeight(K.a.Finger.Index,2),Z.setWeight(K.a.Finger.Middle,2);var $=t(291),ee=function(){return $.a()},ne=function(e){var n=Object(r.useContext)(j),t=F(ee,e),i=e.onHandEstimate,a=Object(r.useCallback)(function(){var e=Object(v.a)(g.a.mark((function e(n){var r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=t.current)){e.next=6;break}return e.next=4,r.estimateHands(n);case 4:e.sent.forEach((function(e){i(e)}));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[t,i]);return Object(r.useEffect)((function(){a(n.video)}),[n,a]),null},te={position:"absolute",top:0,left:0,right:0,zIndex:-1,width:640,height:480},re={scissor:"\u270c\ud83c\udffb",rock:"\u270a",paper:"\u270b"},ie=function(e){var n=Object(r.useRef)(new K.a.GestureEstimator([X,Y,Z])),t=Object(r.useState)(),i=Object(u.a)(t,2),a=i[0],c=i[1];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("div",{style:{position:"fixed",left:32},children:Object(b.jsx)("h1",{children:re[a]})}),Object(b.jsx)(p,{style:te,children:Object(b.jsx)(ne,{backend:"webgl",onHandEstimate:function(e){var t=n.current.estimate(e.landmarks,7.5);if(t.gestures.length>0){var r=t.gestures.reduce((function(e,n){return e.confidence>n.confidence?e:n}));a!==r.name&&c(r.name)}}})})]})},ae=(t(444),t(36)),ce=.65;function oe(e,n,t,r){var i=e.keypoints;!function(e,n,t){var r,i=Object(ae.a)(n.middle);try{for(i.s();!(r=i.n()).done;){se(e[r.value],"yellow",t)}}catch(l){i.e(l)}finally{i.f()}var a,c=Object(ae.a)(n.left);try{for(c.s();!(a=c.n()).done;){se(e[a.value],"lime",t)}}catch(l){c.e(l)}finally{c.f()}var o,s=Object(ae.a)(n.right);try{for(s.s();!(o=s.n()).done;){se(e[o.value],"red",t)}}catch(l){s.e(l)}finally{s.f()}}(i,n,r),function(e,n,t){t.fillStyle="White",t.strokeStyle="White",t.lineWidth=3,n.forEach((function(n){var r=Object(u.a)(n,2),i=r[0],a=r[1],c=e[i],o=e[a],s=null!=c.score?c.score:1,l=null!=o.score?o.score:1;s>=ce&&l>=ce&&(t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(o.x,o.y),t.stroke())}))}(i,t,r)}function se(e,n,t){(null!=e.score?e.score:1)>=ce&&(t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.fillStyle=n,t.fill())}var le=function(e){var n=e.type,t=e.runtime;return w.b(w.a.MoveNet,{runtime:t,modelType:n||w.c.modelType.SINGLEPOSE_LIGHTNING})},ue={video:null},de=function(e){var n=Object(r.useRef)(null),t=Object(r.useRef)(null),i=Object(r.useRef)(null),a=Object(r.useRef)(null),c=Object(r.useState)(ue),o=Object(u.a)(c,2),s=o[0],d=o[1],f=e.style,h=e.videoSource,p=e.setCanvas,m=function e(){d((function(e){return Object(l.a)(Object(l.a)({},e),{},{video:n.current})})),a.current=requestAnimationFrame(e)};return Object(r.useEffect)((function(){t.current.src=h,n.current.load()}),[h]),Object(b.jsxs)("div",{children:[Object(b.jsx)("video",{ref:n,autoPlay:!0,onLoadedData:function(){var e=n.current,t=i.current;t.width=e.videoWidth,t.height=e.videoHeight,p(t),m()},onEnded:function(){},style:f,children:Object(b.jsx)("source",{ref:t,type:"video/mp4"})}),Object(b.jsx)("canvas",{ref:i,style:f}),Object(b.jsx)(j.Provider,{value:s,children:e.children})]})},fe=function(e){var n=Object(r.useState)(null),t=Object(u.a)(n,2),i=t[0],a=t[1],c=Object(r.useRef)(null),o=w.a.MoveNet,s=w.d.getKeypointIndexBySide(o),l=w.d.getAdjacentPairs(o),d=Object(r.useState)(null),f=Object(u.a)(d,2),j=f[0],h=f[1];return Object(b.jsxs)("div",{className:"App",children:[null==j&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("input",{type:"file",onChange:function(e){a(e.target.files[0])},accept:"video/*"}),Object(b.jsx)("button",{onClick:function(){h(URL.createObjectURL(i))},children:"Upload"})]}),Object(b.jsx)(de,{style:{position:"absolute",top:0,left:0,right:0,zIndex:9},videoSource:j,setCanvas:function(e){c.current=e},children:Object(b.jsx)(C,{backend:"webgl",runtime:"tfjs",type:w.c.modelType.SINGLEPOSE_LIGHTNING,maxPoses:1,flipHorizontal:!0,loader:le,onPoseEstimate:function(e){var n=c.current.getContext("2d"),t=c.current;n.clearRect(0,0,t.width,t.height),oe(e,s,l,n)}})})]})},je="/rockpaperscissors",be="/cartoonmirror",he="/facemesh",pe="/videoplayback";var me=function(){return Object(b.jsx)(o.a,{children:Object(b.jsx)("div",{children:Object(b.jsxs)(s.c,{children:[Object(b.jsxs)(s.a,{path:"/",exact:!0,children:["This page shows a list of demos in this project.",Object(b.jsxs)("ul",{children:[Object(b.jsx)("li",{children:Object(b.jsx)(o.b,{to:je,children:"RockPaperScissors"})}),Object(b.jsx)("li",{children:Object(b.jsx)(o.b,{to:be,children:"CartoonMirror"})}),Object(b.jsx)("li",{children:Object(b.jsx)(o.b,{to:he,children:"FaceMesh"})}),Object(b.jsx)("li",{children:Object(b.jsx)(o.b,{to:pe,children:"VideoPlayback"})})]})]}),Object(b.jsx)(s.a,{path:je,children:Object(b.jsx)(ie,{})}),Object(b.jsx)(s.a,{path:be,children:Object(b.jsx)(L,{})}),Object(b.jsx)(s.a,{path:he,children:Object(b.jsx)(Q,{})}),Object(b.jsx)(s.a,{path:pe,children:Object(b.jsx)(fe,{})})]})})})};c.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(me,{})}),document.getElementById("root"))}},[[450,1,2]]]);
//# sourceMappingURL=main.cf8238f1.chunk.js.map